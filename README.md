# Portfolio (TanStack Start + Convex)

Minimalist portfolio inspired by the DennisLV layout, with a realtime Convex-powered admin panel.

## Features

- Public portfolio page at `/`
  - Hero widgets: availability, quick stats, Spotify now playing
  - Sign the Wall widget with moderated ticker
  - Projects loaded from Convex (`published` only)
  - Testimonials with interactive switching
  - Contact form writing to Convex inbox
  - Analytics tracking (page views, project interactions, CTA clicks, testimonial switch, contact submits, wall submits)
- Admin panel at `/admin`
  - Open mode (no auth gating for now)
  - CRUD + reorder for projects and testimonials
  - Messages inbox with status updates
  - Analytics dashboard (KPI, timeseries, top projects)
  - Wall moderation tab (pending/approved/archived)
  - Site widget settings editor
  - One-click dummy content seeding

## Stack

- TanStack Start (React)
- Convex (database + realtime functions)
- Better Auth (kept in codebase, planned to enable after content work)
- Tailwind + shadcn/ui

## Setup

1. Install dependencies:

```bash
pnpm install
```

2. Configure `.env`:

```env
CONVEX_DEPLOYMENT=...
VITE_CONVEX_URL=...
VITE_CONVEX_SITE_URL=...

BETTER_AUTH_URL=http://localhost:3000
BETTER_AUTH_SECRET=...

OWNER_EMAILS=smiarowski.jakub@gmail.com
ADMIN_ISSUE_SECRET=dev-admin-issue-secret-change-me

GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...
```

3. Configure Spotify secrets in Convex environment:

```bash
npx convex env set SPOTIFY_CLIENT_ID your_client_id
npx convex env set SPOTIFY_CLIENT_SECRET your_client_secret
npx convex env set SPOTIFY_REFRESH_TOKEN your_refresh_token
```

4. Run locally:

```bash
pnpm dev
```

5. Build:

```bash
pnpm build
```

## Notes

- `src/routeTree.gen.ts` is auto-generated by TanStack Router. Do not edit manually.
- Admin auth is intentionally bypassed right now (`OPEN_ADMIN_MODE` in Convex) until final auth hardening.
- If your Convex deployment schema changed, run your Convex workflow (`npx convex dev`) to refresh generated types.
- Current environment warning seen during build: Vite requires newer Node (`20.19+` or `22.12+`).
- Spotify widget data is served from Convex (`spotifyNowPlaying.getPublic`) and refreshed via Convex action (`spotifyNowPlaying.refresh`).
- Spotify credentials must be set in Convex env (`npx convex env set ...`), not only in app `.env`.
- Spotify refresh token quick setup:
  1. Create an app in Spotify Developer Dashboard and copy client id/secret.
  2. Authorize with `scope=user-read-currently-playing user-read-recently-played`.
  3. Exchange code for refresh token and set `SPOTIFY_REFRESH_TOKEN` in env.
- Full setup walkthrough: see `docs/spotify-widget-setup.md`.
- Fallback behavior: active playback shows `playing`, otherwise the latest recently played track shows `idle`; API failures return `unavailable` without breaking layout.
